# üê≥ DOCKERFILE –î–õ–Ø TELEGRAM –ë–û–¢–ê

FROM python:3.13-slim

# üìù –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
LABEL maintainer="lea_alex"
LABEL description="Telegram Bot –Ω–∞ aiogram 3.x"
LABEL version="1.0.0"

# üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    gcc \
    curl \
    && rm -rf /var/lib/apt/lists/*

# üìÅ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
WORKDIR /app

# üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY bot/requirements.txt .

# üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# üìã –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (–ø–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–æ–≤)
COPY bot/config.py ./
COPY bot/webhook.py ./
COPY bot/handlers/ ./handlers/
COPY bot/utils/ ./utils/
COPY bot/assets/ ./assets/
COPY __init__.py ./

# üë§ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN useradd --create-home --shell /bin/bash app && \
    chown -R app:app /app
USER app

# üåê –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Ä—Ç–∞
EXPOSE 8443

# üéØ –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["python", "webhook.py"]
